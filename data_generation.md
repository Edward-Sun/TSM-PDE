# Data

## Test data

The test data can be generated by running the following command:

### Warmup

Warm up from random initial conditions:

```bash
export PSCRATCH=/your/path/to/scratch_storage
export PYTHONPATH="$PWD:$PYTHONPATH"
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export XLA_PYTHON_CLIENT_PREALLOCATE=false
export HAIKU_FLATMAPPING=0

export STORAGE_PATH=$PSCRATCH/cfd
export MODEL_NAME=dns_2048x2048_test

python -u tsm/dns_warmup.py \
  --model_predict_steps=16 \
  --delta_time=0.007012483601762931 \
  --num_samples=16 \
  --inner_steps=1 \
  --train_init_random_seed=42 \
  --model_input_size=2048 \
  --warmup_time=40.9 \
  --simulation_time=0.1 \
  --output_dir="$STORAGE_PATH/models/$MODEL_NAME" \
  --gin_file="tsm/configs/implicit_diffusion_dns_config.gin" \
  --gin_file="tsm/configs/kolmogorov_forcing.gin"
```

### Generation

Generate the test data:

```bash
export PSCRATCH=/your/path/to/scratch_storage
export PYTHONPATH="$PWD:$PYTHONPATH"
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export XLA_PYTHON_CLIENT_PREALLOCATE=false
export HAIKU_FLATMAPPING=0

export MODEL_NAME=dns_2048x2048_test
export PREDICTDATA=models/${MODEL_NAME}/predict.nc
export STORAGE_PATH=$PSCRATCH/cfd

python -u tsm/dns_warmup.py \
  --model_input_size=2048 \
  --model_encode_steps=1 \
  --model_predict_steps=32 \
  --predict_log_every=32 \
  --simulation_time=20.0 \
  --delta_time=0.007012483601762931 \
  --predict_split="$STORAGE_PATH/$PREDICTDATA" \
  --predict_result="test.nc" \
  --explicit_inner_steps 1 \
  --output_dir="$STORAGE_PATH/models/$MODEL_NAME" \
  --gin_file="tsm/configs/implicit_diffusion_dns_config.gin" \
  --gin_file="tsm/configs/kolmogorov_forcing.gin"
```


## Training data

The training data can be generated by running the following command:

### Warmup

```bash
export TRAINING_DATA_SEED=909  # I used 909-916 for the paper
export PSCRATCH=/your/path/to/scratch_storage
export PYTHONPATH="$PWD:$PYTHONPATH"
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export XLA_PYTHON_CLIENT_PREALLOCATE=false
export HAIKU_FLATMAPPING=0

export STORAGE_PATH=$PSCRATCH/cfd
export MODEL_NAME=dns_2048x2048_train_${TRAINING_DATA_SEED}
export PREDICTDATA=models/${MODEL_NAME}/predict.nc

python -u tsm/dns_warmup.py \
  --model_predict_steps=16 \
  --delta_time=0.007012483601762931 \
  --num_samples=16 \
  --inner_steps=1 \
  --train_init_random_seed=$TRAINING_DATA_SEED \
  --model_input_size=2048 \
  --warmup_time=40.0 \
  --simulation_time=1.0 \
  --output_dir="$STORAGE_PATH/models/$MODEL_NAME" \
  --gin_file="tsm/configs/implicit_diffusion_dns_config.gin" \
  --gin_file="tsm/configs/kolmogorov_forcing.gin"
```

### Generation

```bash
export TRAINING_DATA_SEED=909  # I used 909-916 for the paper
export PSCRATCH=/your/path/to/scratch_storage
export PYTHONPATH="$PWD:$PYTHONPATH"
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export XLA_PYTHON_CLIENT_PREALLOCATE=false
export HAIKU_FLATMAPPING=0

export STORAGE_PATH=$PSCRATCH/cfd
export MODEL_NAME=dns_2048x2048_train_${TRAINING_DATA_SEED}
export PREDICTDATA=models/${MODEL_NAME}/predict.nc

python -u tsm/dns_generate.py \
  --model_input_size=2048 \
  --model_encode_steps=1 \
  --model_predict_steps=32 \
  --simulation_time=80.0 \
  --delta_time=0.007012483601762931 \
  --predict_split="$STORAGE_PATH/$PREDICTDATA" \
  --predict_result="train.nc" \
  --explicit_inner_steps 1 \
  --output_dir="$STORAGE_PATH/models/$MODEL_NAME" \
  --gin_file="tsm/configs/implicit_diffusion_dns_config.gin" \
  --gin_file="tsm/configs/kolmogorov_forcing.gin"
```
